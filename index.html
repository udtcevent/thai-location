<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INDEX PAGE | ที่ตั้งในประเทศไทย</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/48ae6a34dc.js" crossorigin="anonymous"></script>

</head>

<body>
    <table class="table table-striped" style="background-color: #212121; color: #fff">
        <thead>
            <tr>
                <th style="width: 90%"><input type="text" id="keywordSearch" style="width:100%; height: 48px;" class="form-control" placeholder="กรอกคำที่ต้องการค้นหา..." /></th>
                <th style="width: 10%"><button type="button" id="btnSearch" class="btn btn-primary btn-lg" style="width: 100%"><i class="fa fa-search"></i></button></th>
            </tr>
        </thead>
    </table>

    <table class="table table-striped" style="margin-top: -17px;">
        <thead>
            <tr>
                <th colspan="3" style="width: 30%">
                    <center><strong>กรุณาเลือกจังหวัด, อำเภอ, ตำบล ที่ต้องการค้นหาหมู่บ้าน</strong></center>
                </th>
            </tr>
            <tr>
                <th style="width: 30%">
                    <span class="input-group-text" style="width:100%; background-color:#000; color:#fff;">[PROVINCE] : จังหวัด</span>
                    <select class="form-select" style="width:100%;" id="province" disabled="true">
                        <option value="null">--------- เลือกจังหวัดที่ต้องการค้นหา ---------</option>
                    </select>
                </th>
                <th style="width: 30%">
                    <span class="input-group-text" style="width:100%; background-color:#000; color:#fff;">[AMPHUR] : อำเภอ</span>
                    <select class="form-select" style="width:100%;" id="amphure" disabled="true">
                        <option value="null">--------- เลือกอำเภอที่ต้องการค้นหา ---------</option>
                    </select>
                </th>
                <th style="width: 30%">
                    <span class="input-group-text" style="width:100%; background-color:#000; color:#fff;">[DISTRICT] : ตำบล</span>
                    <select class="form-select" style="width:100%;" id="tambon" disabled="true">
                        <option value="null">--------- เลือกตำบลที่ต้องการค้นหา ---------</option>
                    </select>
                </th>
            </tr>
        </thead>
    </table>

    <div id="resultView" style="text-align: center; font-size:20px;">กรุณากรอกข้อมูลก่อนทำการค้นหาที่ตั้ง หรือเลือกจากรายการด้านบน</div>
    
    <footer style="text-align: center; font-size:20px; position: fixed;  left: 0;  bottom: 0;  width: 100%;">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th style="width:100%;"><button type="button" id="btnSignIn" class="btn btn-success btn-lg" style="width: 100%"><i class="fa fa-sign-in"></i>  เข้าสู่ระบบ (สำหรับเจ้าหน้าที่)</button></th>
                </tr>
            </thead>
        </table>
    </footer>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyBklmrQQibQWKU1yB09ULbGDdLQ6ZDvcnw",
            authDomain: "thai-locations.firebaseapp.com",
            databaseURL: "https://thai-locations-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "thai-locations",
            storageBucket: "thai-locations.appspot.com",
            messagingSenderId: "76576846444",
            appId: "1:76576846444:web:839a8856657d3795a85e49",
            measurementId: "G-VPHN7Q423C"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        import { getDatabase, ref, child, get, set, update, remove } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

        const db = getDatabase();

        let keywordSearch = document.getElementById('keywordSearch');
        let btnSearch = document.getElementById('btnSearch');
        let province = document.getElementById('province');
        let amphure = document.getElementById('amphure');
        let serchView = document.getElementById('serchView');
        let tambon = document.getElementById('tambon');
        let btnSignIn = document.getElementById('btnSignIn');

        let curDateMain = new Date();
        let curDate = curDateMain.getFullYear() + '-' + (curDateMain.getMonth() < 10 ? '0' + (curDateMain.getMonth() + 1) : (curDateMain.getMonth() + 1)) + '-' + (curDateMain.getDate() < 10 ? '0' + curDateMain.getDate() : curDateMain.getDate());
        let curTime = curDateMain.getHours() + ':' + curDateMain.getMinutes() + ':' + curDateMain.getSeconds() + ':' + '00';

        const loadProvince = () => {
            const dbRef = ref(db);
            get(child(dbRef, 'thai_province/')).then((snapshot) => {
                if (snapshot.exists()) {
                    for (let i = 0; i < snapshot.val().length; i++) {
                        const dataProvince = snapshot.val()[i];
                        let optProvince = document.createElement('option');
                        optProvince.value = dataProvince.id;
                        optProvince.innerHTML = (i + 1) + '. [ ' + dataProvince.name_en + ' ] : ' + dataProvince.name_th;
                        province.append(optProvince);
                    }
                    province.disabled = false;
                }
            });
        }

        province.addEventListener('change', () => {
            const provID = province.value;
            amphure.disabled = true;
            amphure.innerHTML = '';
            loadAmphure(provID);
        });

        const loadAmphure = (provID) => {
            const dbRef = ref(db);
            get(child(dbRef, 'thai_amphures/')).then((snapshot2) => {
                if (snapshot2.exists()) {
                    amphure.disabled = false;
                    for (let j = 0; j < snapshot2.val().length; j++) {
                        const dataAmphure = snapshot2.val()[j];
                        let optAmphure = document.createElement('option');
                        if (dataAmphure.province_id == provID) {
                            optAmphure.value = dataAmphure.id;
                            optAmphure.innerHTML = (j + 1) + '. [ ' + dataAmphure.name_en + ' ] : ' + dataAmphure.name_th;
                            amphure.append(optAmphure);   
                        }
                    }
                }
            });
        }

        amphure.addEventListener('change', () => {
            const amphID = amphure.value;
            tambon.disabled = true;
            tambon.innerHTML = '';
            loadTambon(amphID);
        });

        const loadTambon = (amphID) => {
            const dbRef = ref(db);
            get(child(dbRef, 'thai_tambons/')).then((snapshot3) => {
                if (snapshot3.exists()) {
                    tambon.disabled = false;
                    for (let k = 0; k < snapshot3.val().length; k++) {
                        const dataTambon = snapshot3.val()[k];
                        let optTambon = document.createElement('option');
                        if (dataTambon.amphure_id == amphID) {
                            optTambon.value = dataTambon.id;
                            optTambon.innerHTML = (k + 1) + '. [ ' + dataTambon.name_en + ' ] : ' + dataTambon.name_th;
                            tambon.append(optTambon);   
                        }
                    }
                }
            });
        }

        window.addEventListener('load', loadProvince);

        btnSignIn.addEventListener(('click'),  () => { window.location.replace('signin.html'); });
    </script>
</body>

</html>
